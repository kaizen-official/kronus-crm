// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id                String   @id @default(auto()) @map("_id") @db.ObjectId
  email             String   @unique
  password          String
  name              String
  phone             String?
  roles             Role[]   @default([SALESMAN])
  isActive          Boolean  @default(true)
  lastLoginAt       DateTime?
  profileImage      String?
  department        String?
  designation       String?
  resetPasswordToken String?
  resetPasswordExpire DateTime?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  // Relations
  createdLeads      Lead[]   @relation("LeadCreator")
  assignedLeads     Lead[]   @relation("LeadAssignee")
  activities        Activity[]
  
  @@map("users")
}

model Lead {
  id              String      @id @default(auto()) @map("_id") @db.ObjectId
  name            String
  email           String?
  phone           String
  property        String
  source          LeadSource  @default(WEBSITE)
  status          LeadStatus  @default(NEW)
  priority        Priority    @default(MEDIUM)
  value           Float?
  followUpDate    DateTime?
  
  // Relations
  createdById     String      @db.ObjectId
  createdBy       User        @relation("LeadCreator", fields: [createdById], references: [id])
  assignedToId    String?     @db.ObjectId
  assignedTo      User?       @relation("LeadAssignee", fields: [assignedToId], references: [id])
  activities      Activity[]
  documents       Document[]
  
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  @@map("leads")
}

model Activity {
  id          String       @id @default(auto()) @map("_id") @db.ObjectId
  type        ActivityType
  title       String
  description String?
  date        DateTime     @default(now())
  
  // Relations
  userId      String       @db.ObjectId
  user        User         @relation(fields: [userId], references: [id])
  leadId      String?      @db.ObjectId
  lead        Lead?        @relation(fields: [leadId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  
  @@map("activities")
}

enum Role {
  ADMIN
  EXECUTIVE
  DIRECTOR
  MANAGER
  SALESMAN
}

enum LeadSource {
  WEBSITE
  REFERRAL
  INSTAGRAM
  YOUTUBE
  EMAIL
  WHATSAPP
  NINETY_NINE_ACRES
  MAGICBRICKS
  OLX
  COLD_OUTREACH
  WALK_IN
}

enum LeadStatus {
  NEW
  CONTACTED
  INTERESTED
  NOT_INTERESTED
  SITE_VISIT
  NEGOTIATION
  DOCUMENTATION
  WON
  LOST
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum ActivityType {
  CALL
  EMAIL
  MEETING
  NOTE
  TASK
  FOLLOW_UP
}

model SystemLog {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  level     String   // "ERROR", "WARN", "INFO"
  message   String
  stack     String?
  path      String?
  method    String?
  userId    String?
  timestamp DateTime @default(now())
  
  @@map("system_logs")
}

model Document {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  url       String
  type      String   // "PDF", "IMAGE"
  size      Int?     // in bytes
  
  leadId    String   @db.ObjectId
  lead      Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  
  @@map("documents")
}
